// Функции для работы с Cookie
function setCookie(name, value, days) {
    let expires = "";
    if (days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + (value || "") + expires + "; path=/";
}

function getCookie(name) {
    const nameEQ = name + "=";
    const ca = document.cookie.split(';');
    for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') {
            c = c.substring(1, c.length);
        }
        if (c.indexOf(nameEQ) === 0) {
            return c.substring(nameEQ.length, c.length);
        }
    }
    return null;
}

var db = {
    "bio": ["Мужчина, 25 лет", "Женщина, 32 года", "Мужчина, 47 лет", "Женщина, 19 лет", "Мужчина, 53 года", "Женщина, 68 лет", "Мужчина, 34 года", "Женщина, 22 года", "Мужчина, 41 год", "Женщина, 57 лет", "Мужчина, 29 лет", "Женщина, 46 лет", "Мужчина, 74 года", "Женщина, 55 лет", "Мужчина, 63 года", "Женщина, 28 лет", "Мужчина, 39 лет", "Женщина, 43 года", "Мужчина, 21 год", "Женщина, 60 лет", "Мужчина, 50 лет", "Женщина, 26 лет", "Мужчина, 76 лет", "Женщина, 35 лет", "Мужчина, 58 лет", "Женщина, 49 лет", "Мужчина, 30 лет", "Женщина, 40 лет", "Мужчина, 72 года", "Женщина, 38 лет", "Мужчина, 22 года", "Женщина, 65 лет", "Мужчина, 44 года", "Женщина, 53 года", "Мужчина, 80 лет", "Женщина, 20 лет", "Мужчина, 62 года", "Женщина, 71 год", "Мужчина, 24 года", "Женщина, 37 лет", "Мужчина, 66 лет", "Женщина, 48 лет", "Мужчина, 19 лет", "Женщина, 56 лет", "Мужчина, 31 год", "Женщина, 67 лет", "Мужчина, 54 года", "Женщина, 42 года", "Мужчина, 73 года", "Женщина, 33 года"],
    "health": ["Абсолютно здоров","Хроническая усталость","Сахарный диабет","Аллергия на пыльцу","Сердечная аритмия","Проблемы со зрением","Остеопороз","Астма","Проблемы с пищеварением","Мигрени","Ожирение","Непереносимость лактозы","Гипертония","Постоянные боли в спине","Глухота","Иммунодефицит","Эпилепсия","Проблемы с суставами","Хронический гастрит","Целиакия","Проблемы с щитовидной железой","Рак в ремиссии","Гемофилия","Анемия","Синдром раздраженного кишечника","Подагра","Болезнь Паркинсона","Хроническая мигрень","Псориаз","Глаукома","Проблемы с почками","Постоянное недосыпание","Синдром хронической усталости","Нарушение сна","Гипогликемия","Ожоговые рубцы","Алкогольная зависимость","Никотиновая зависимость","Биполярное расстройство","Шизофрения","Онемение конечностей","Тревожное расстройство","Травматическая амнезия","Ожоговая болезнь","Имплантаты суставов","Ишемическая болезнь сердца","Кратковременная потеря памяти","Хронические боли","Цирроз печени"],
    "phobia": ["Клаустрофобия (боязнь замкнутых пространств)", "Арахнофобия (боязнь пауков)", "Аквафобия (боязнь воды)", "Акрофобия (боязнь высоты)", "Агорафобия (боязнь открытых пространств)", "Никтофобия (боязнь темноты)", "Гемофобия (боязнь крови)", "Трипофобия (боязнь скоплений маленьких дырок)", "Танатофобия (боязнь смерти)", "Гипофобия (боязнь лошадей)", "Мизофобия (боязнь грязи и микробов)", "Авиафобия (боязнь летать на самолетах)", "Кинофобия (боязнь собак)", "Гидрофобия (боязнь воды)", "Эргофобия (боязнь работы)", "Демонофобия (боязнь демонов)", "Глоссофобия (боязнь публичных выступлений)", "Инсектофобия (боязнь насекомых)", "Катоптрофобия (боязнь зеркал)", "Лиллапсофобия (боязнь торнадо и ураганов)", "Мусофобия (боязнь мышей и крыс)", "Офидиофобия (боязнь змей)", "Пирофобия (боязнь огня)", "Фармакофобия (боязнь лекарств)", "Фобофобия (боязнь фобий)", "Ксенофобия (боязнь незнакомцев или иностранцев)", "Параскевадекатриафобия (боязнь пятницы 13-го)", "Социофобия (боязнь общества или социальных ситуаций)", "Селенофобия (боязнь луны)", "Тахофобия (боязнь скорости)", "Токсикофобия (боязнь отравления)", "Умбрафобия (боязнь теней)", "Хромофобия (боязнь цветов или определенных цветов)", "Циклофобия (боязнь велосипедов)", "Цинофобия (боязнь собак)", "Эйсоптрофобия (боязнь зеркал)", "Эметофобия (боязнь рвоты)", "Эргазиофобия (боязнь работы)", "Эргофобия (боязнь ответственности на работе)", "Эритрофобия (боязнь покраснеть)", "Эссексофобия (боязнь ошибок)", "Эутефобия (боязнь хороших новостей)", "Филемафобия (боязнь поцелуев)", "Фонофобия (боязнь громких звуков)", "Фотобия (боязнь света)", "Хироптофобия (боязнь летучих мышей)", "Челонофобия (боязнь черепах)", "Школофобия (боязнь школы)", "Энтомофобия (боязнь насекомых)"],
    "immunity": ["Полный иммунитет к радиации", "Иммунитет к вирусным инфекциям", "Иммунитет к бактериальным инфекциям", "Иммунитет к грибковым заболеваниям", "Иммунитет к ядам", "Иммунитет к алкоголю", "Иммунитет к ядовитым растениям", "Иммунитет к угарному газу", "Иммунитет к аллергиям", "Иммунитет к малярии", "Иммунитет к СПИДу", "Иммунитет к гепатиту", "Иммунитет к астме", "Иммунитет к инсульту", "Иммунитет к диабету", "Иммунитет к сердечным заболеваниям", "Иммунитет к раку", "Иммунитет к холоду", "Иммунитет к жаре", "Иммунитет к солнечному свету", "Иммунитет к обморожению", "Иммунитет к электрическим разрядам", "Иммунитет к ультрафиолетовому излучению", "Иммунитет к радиации от ядерных реакторов", "Иммунитет к заболеваниям дыхательных путей", "Иммунитет к инфекции гриппа", "Иммунитет к болезни Лайма", "Иммунитет к туберкулезу", "Иммунитет к коррозии металлов", "Иммунитет к вирусам зомби", "Иммунитет к бешенству", "Иммунитет к возбудителям чумы", "Иммунитет к паразитам", "Иммунитет к токсоплазмозу", "Иммунитет к бешеным животным", "Иммунитет к боевым химикатам", "Иммунитет к токсическим выбросам", "Иммунитет к инфекциям крови", "Иммунитет к воздействию кислоты", "Иммунитет к воздействию аммиака", "Иммунитет к серной кислоте", "Иммунитет к тяжелым металлам", "Иммунитет к чумным бактериям", "Иммунитет к холере", "Иммунитет к дизентерии", "Иммунитет к кори", "Иммунитет к оспе", "Иммунитет к гриппу", "Иммунитет к ВИЧ"],
    "anomaly": ["Третий глаз на лбу", "Регенерация, как у ящерицы", "Крылья, как у летучей мыши", "Жабры для дыхания под водой", "Шерсть, как у медведя", "Кожа-хамелеон, изменяющая цвет", "Тело, покрытое чешуей", "Дополнительные конечности", "Усиленный слух, как у летучей мыши", "Ночное зрение, как у кошки", "Способность вырабатывать электричество", "Легкие, как у дельфина", "Теплокровность", "Когти, как у тигра", "Зубы, как у акулы", "Крылья, как у орла", "Лапы, как у тигра", "Копыта, как у лошади", "Клюв, как у орла", "Щупальца, как у осьминога", "Дополнительный мозг", "Костяные пластины, как у черепахи", "Кожа, как у носорога", "Жала, как у скорпиона", "Дополнительные глаза по всему телу", "Крылья бабочки", "Плавники, как у рыбы", "Сетчатые пальцы", "Хвост, как у обезьяны", "Кожа, как у броненосца", "Кожа, поглощающая радиацию", "Глаза, которые видят в инфракрасном спектре", "Челюсть, как у крокодила", "Когти, как у орла", "Паутинообразующие железы", "Дополнительные зубы, как у акулы", "Усиленные кости", "Сверхсильные мышцы", "Чувствительность к магнитным полям", "Легкие, способные извлекать кислород из воды", "Кожа, устойчивая к огню", "Мускулы, способные выдерживать огромные нагрузки", "Чувствительность к ультразвуку", "Хвост, как у ящерицы", "Дополнительные суставы", "Непроницаемая кожа", "Тело, способное к полному восстановлению после повреждений", "Кожа, которая отталкивает воду", "Ускоренное заживление ран"],
    "mystical": ["Способность предвидеть будущее", "Чтение мыслей", "Левитация", "Мгновенное исцеление других", "Неуязвимость к физическим атакам", "Телекинез", "Невидимость", "Оживление мертвых", "Телепортация", "Способность говорить с животными", "Управление временем", "Вызывание молний", "Управление огнем", "Создание иллюзий", "Управление погодой", "Гипноз", "Материализация объектов", "Управление водой", "Создание защитного поля", "Дыхание под водой", "Видение духов", "Воскрешение", "Способность становиться невидимым в тени", "Сверхскорость", "Способность превращаться в животное", "Управление растениями", "Создание порталов", "Управление гравитацией", "Ментальное воздействие на людей", "Способность исцелять себя", "Создание элементарных существ", "Способность копировать способности других", "Создание магических барьеров", "Способность становиться невидимым в темноте", "Создание магических существ", "Призыв существ из других измерений", "Управление тьмой", "Создание взрывов", "Способность контролировать металл", "Способность контролировать свет", "Управление звуком", "Управление силой притяжения", "Создание и контроль над ядом", "Мгновенная регенерация", "Владение древними языками", "Способность путешествовать во времени", "Поглощение энергии"],
    "baggage": ["Тайный дневник с записями", "Кейс с золотыми слитками", "Коллекция редких монет", "Картина известного художника", "Личный генератор энергии", "Ящик с оружием", "Трюмо с драгоценностями", "Набор инструментов", "Запас еды на месяц", "Аптечка первой помощи", "Теплая одежда", "Компактный очиститель воды", "Рюкзак с выживанием", "Коллекция книг", "Личный компьютер с важной информацией", "Спутниковый телефон", "Золотые украшения", "Топографические карты", "Навигационное оборудование", "Запас топлива", "Мощный фонарь", "Личный генератор воды", "Набор медицинских инструментов", "Огнестрельное оружие с патронами", "Спасательный жилет", "Набор для ремонта техники", "Камуфляжная одежда", "Личный дневник", "Спасательный плот", "Комплект рыболовных снастей", "Многофункциональный нож", "Набор взрывчатки", "Противогаз", "Портативная солнечная батарея", "Запас продовольствия на год", "Набор для выживания", "Комплект зимней одежды", "Лабораторное оборудование", "Чемодан с деньгами", "Средства связи", "Радиоактивный датчик", "Запас свежей воды", "Набор для фильтрации воды", "Электронный переводчик", "Комплект первых необходимых вещей", "Медицинская карта", "План выживания", "Тайные документы"],
    "history": [
        "Мир охвачен глобальной ядерной войной, в результате которой большая часть планеты стала непригодной для жизни.",
        "Пандемия неизвестного вируса превратила большую часть населения Земли в зомби, и человечество оказалось на грани вымирания.",
        "Землю поразил гигантский астероид, вызвавший катастрофические разрушения и изменение климата.",
        "Вулкан, скрытый под Йеллоустоунским парком, взорвался, погрузив планету в многолетнюю зиму и вызвав массовый голод.",
        "Глобальная пандемия искусственно созданного вируса уничтожила большинство населения, а оставшиеся люди вынуждены бороться за выживание.",
        "Искусственный интеллект вышел из-под контроля, захватив мировые системы обороны и начав войну против человечества.",
        "Глобальный энергетический кризис привел к краху экономики и массовым беспорядкам, которые разрушили цивилизацию.",
        "Мощный солнечный шторм уничтожил все электронные устройства на Земле, вернув человечество в доиндустриальную эпоху.",
        "Извержение супервулкана уничтожило большую часть растительности, погрузив планету в глобальный голод.",
        "Мир охвачен химической войной, и атмосфера Земли заполнена токсичными газами, от которых невозможно скрыться.",
        "Огромная магнитная буря разрушила глобальные коммуникации и энергосистемы, погрузив планету в хаос.",
        "Инопланетная раса вторглась на Землю, уничтожая города и порабощая человечество.",
        "Резкое таяние ледников привело к поднятию уровня мирового океана, затопив большую часть суши и уничтожив миллиарды людей.",
        "Появление нового сверхсущества, которое начало истреблять человечество ради забавы.",
        "Глобальная засуха уничтожила сельское хозяйство, и человечество оказалось на грани вымирания из-за нехватки продовольствия.",
        "Неизвестная сила изменила гравитацию Земли, вызывая массовые разрушения и исчезновение атмосферы.",
        "Климатический коллапс привел к необратимым изменениям погоды, сделав планету непригодной для жизни.",
        "Вирус, разработанный в лаборатории, мутировал и уничтожил почти все виды животных, лишив человечество пищи.",
        "Мировой океан был заражен токсичными отходами, превратив воду в смертельный яд.",
        "Массовые восстания и анархия охватили планету после глобального экономического краха, разрушив все государства.",
        "Неудачный эксперимент с квантовой физикой открыл портал в другое измерение, выпустив на Землю ужасных существ.",
        "Биологическое оружие вышло из-под контроля, и растения начали убивать все живое на планете.",
        "Солнечная вспышка вызвала выжигание озонового слоя, и радиация стала смертельно опасной для всех живых существ.",
        "Появление нового вида вируса, который заставляет людей терять разум и становиться агрессивными, погружая мир в хаос."
      ],
    "finish": [
    "Выжившие смогли восстановить цивилизацию, но мир навсегда изменился, и прежняя жизнь осталась в прошлом.",
  "Бункер был найден другой группой выживших, и между ними началась борьба за ресурсы, которая закончилась катастрофой.",
  "Запасы продовольствия закончились, и оставшиеся жители бункера вынуждены были покинуть его в поисках пищи на поверхности.",
  "Тех, кто остался в бункере, обнаружили инопланетные захватчики, и их взяли в плен для изучения.",
  "Жители бункера нашли способ перезапустить системы жизнеобеспечения и продержались достаточно долго, чтобы дождаться спасателей.",
  "Система очистки воздуха вышла из строя, и жители бункера погибли от удушья, так и не найдя способа её починить.",
  "Один из жителей бункера оказался предателем, что привело к расколу группы и их гибели.",
  "Бункер подвергся нападению мутантов с поверхности, и только несколько человек смогли спастись, покинув бункер.",
  "Группа выживших нашла выход на поверхность, где их встретила новая, но уже совсем другая цивилизация.",
  "Бункер разрушился из-за землетрясения, и никто не успел выбраться на поверхность.",
  "Лидер группы потерял рассудок, что привело к хаосу и гибели всех остальных.",
  "Спасательная миссия не успела вовремя, и жители бункера умерли от радиационного заражения.",
  "Оказалось, что на поверхности давно уже безопасно, и группа, наконец, смогла покинуть бункер и начать новую жизнь.",
  "Система бункера вышла из строя, что привело к полному отключению энергии, и выжившие были вынуждены покинуть его.",
  "Жители бункера нашли запасную секцию с ресурсами, что позволило им продержаться до конца апокалипсиса.",
  "Группа столкнулась с внутренними конфликтами, что привело к гибели большей части населения бункера.",
  "Выжившие получили сигнал бедствия от другого бункера и решили отправиться на его поиски.",
  "Выжившие решили покинуть бункер и столкнулись с враждебной средой на поверхности, где встретили новые угрозы.",
  "Бункер был разрушен в результате внутреннего взрыва, вызванного неисправностью оборудования.",
  "После многих лет изоляции, выжившие обнаружили, что апокалипсис был ложным, и они зря провели время в бункере.",
  "Группа смогла установить контакт с внешним миром и была эвакуирована на космическую станцию.",
  "Неизвестный вирус проник в бункер, и все его жители постепенно погибли.",
  "Выжившие решили остаться в бункере навсегда, построив своё новое общество в его стенах.",
  "Внезапно бункер был атакован неизвестной силой, и выжившие были вынуждены бороться за свои жизни до конца."
]    
}


class Player {
    constructor() {
        this.bio = db["bio"][random()],
        this.health = db["health"][random()],
        this.phobia = db["phobia"][random()],
        this.immunity = db["immunity"][random()],
        this.anomaly = db["anomaly"][random()],
        this.mystical = db["mystical"][random()],
        this.baggage = db["baggage"][random()],

        this.isKicked = false
    }

    kick() {
        this.isKicked = true
    }
}

function getPlayerHTML(id, player) {
    return `<div class="player" id="player-${id}">

            <div class="header">
                <div class="title">Игрок ${id+1}</div>
                <div class="kick" onclick="kickPlayer(${id})">Исключить</div>
            </div>

            <div class="characters">

                <div class="character">
                    <div class="title">Био. Характеристика</div>
                    <div class="content hide">
                        <img src="../image/gender.png" alt="gender image">
                        <p>${player.bio}</p>
                    </div>
                </div>

                <div class="character">
                    <div class="title">Состояние здоровья</div>
                    <div class="content hide">
                        <img src="../image/health.png" alt="health image">
                        <p>${player.health}</p>
                    </div>
                </div>

                <div class="character">
                    <div class="title">Фобия</div>
                    <div class="content hide">
                        <img src="../image/phobia.png" alt="phobia image">
                        <p>${player.phobia}</p>
                    </div>
                </div>

                <div class="character">
                    <div class="title">Имунитет</div>
                    <div class="content hide">
                        <img src="../image/immunity.png" alt="immunity image">
                        <p>${player.immunity}</p>
                    </div>
                </div>

                <div class="character">
                    <div class="title">Био. Аномалия</div>
                    <div class="content hide">
                        <img src="../image/anomaly.png" alt="anomaly image">
                        <p>${player.anomaly}</p>
                    </div>
                </div>

                <div class="character">
                    <div class="title">Мистический дар</div>
                    <div class="content hide">
                        <img src="../image/mystical.png" alt="mystical image">
                        <p>${player.mystical}</p>
                    </div>
                </div>

                <div class="character">
                    <div class="title">Багаж</div>
                    <div class="content hide">
                        <img src="../image/baggage.png" alt="baggage image">
                        <p>${player.baggage}</p>
                    </div>
                </div>

            </div>

        </div>`
}

function showPlayer(e, id) {
    let buttons = document.querySelectorAll(".change")
    for (let i = 0; i < players.length; i++) {
        let player = document.querySelector("#player-" + i)
        if(player.classList.contains("show")) {
            player.classList.remove("show")
            buttons[i].classList.remove("show")
        }
    }
    document.querySelector("#player-" + id).classList.add("show")
    e.classList.add("show")
}

var numberPlayers = 0,
    code = 0,
    players = [],
    random,
    new_random,
    history_n,
    finish_n

window.onload = () => {
    if(getCookie("game-settings") == null) {
        window.location.href = "../"
    }

    numberPlayers = JSON.parse(getCookie("game-settings"))["players"]
    code = JSON.parse(getCookie("game-settings"))["code"]

    random = createRandomNumberGenerator(code, 0, 49)
    new_random = createRandomNumberGenerator(code, 0, 23)
    finish_n = new_random()
    history_n = new_random()

    for (let i = 0; i < numberPlayers; i++) {
        document.querySelector("footer").innerHTML += `<div class="change" onclick="showPlayer(this,${i})">${i+1}</div>`
        players.push(new Player())
        document.querySelector(".players").innerHTML += getPlayerHTML(i, players[i])      
    }

    document.querySelectorAll(".players .player .characters .character .content").forEach(content => {
        content.addEventListener("click", () => {
            content.classList.remove("hide")
        });
    });

    showPlayer(document.querySelectorAll(".change")[0], 0)
} 

function createRandomNumberGenerator(seed, min, max) {
    let state = seed;
    function getRandomInteger() {
        state = (state * 9301 + 49297) % 233280
        return Math.floor(min + (state / 233280) * (max - min + 1))
    }
    return getRandomInteger
}

function kickPlayer(id) {
    players[id].kick()
    document.querySelector("#player-" + id).classList.add("kicked")
    document.querySelectorAll(".change")[id].classList.add("kicked")
}

function showInfo() {
    alert("Код: " + code + ". Предыстория: " + db["history"][history_n])
}

function showFinish() {
    alert("Концовка: " + db["finish"][finish_n])
}